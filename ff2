local ReplicatedStorage = game:GetService('ReplicatedStorage')
local VirtualInputManager = game:GetService('VirtualInputManager')
local UserInputService = game:GetService('UserInputService')
local RunService = game:GetService('RunService')
local Workspace = game:GetService('Workspace')
local Players = game:GetService('Players')

local VIM = game:GetService("VirtualInputManager")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild('HumanoidRootPart')
local Humanoid = Character.Humanoid

local repo = 'https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/'

local Library = loadstring(game:HttpGet('https://raw.githubusercontent.com/Zyai-Lua/Inertia.mov/refs/heads/main/Linoria'))()
local ThemeManager = loadstring(game:HttpGet('https://raw.githubusercontent.com/Zyai-Lua/Inertia.mov/refs/heads/main/LinoriaTheme'))()
local SaveManager = loadstring(game:HttpGet(repo .. 'addons/SaveManager.lua'))()
local FrameCounter, FrameTimer, FPS,StartTime = 0,0,60, tick()

local Window = Library:CreateWindow({

	Title = '<font color=\"#007dff\">Inertia</font> - <i>FF2</i>',
	Center = true,
	AutoShow = true,
	TabPadding = 8,
	MenuFadeTime = 0.2
})

local Tabs = {
	Main = Window:AddTab('Main'),
	['UI Settings'] = Window:AddTab('UI Settings'),
}

local Main = Tabs.Main:AddLeftGroupbox('Main')

Main:AddToggle('Magnets', {Text = 'Ball Magnets',Default = false,})
Main:AddSlider('MagnetsDistance', {Text = 'Distance',Default = 10,Min = 0,Max = 100,Rounding = 1,Compact = false})

Main:AddToggle('Anti-Block', {Text = 'Anti Block',Default = false,})
Main:AddToggle('Anti-Jam', {Text = 'Anti Jam',Default = false,})
Main:AddToggle('KickerAimbot', {Text = 'Kicker Aimbot',Default = false,})
Main:AddToggle('FootballTracers', {Text = 'Football Tracers',Default = false,}):AddColorPicker('FootballTracersColor', {Default = Color3.fromRGB(0, 125, 255),Title = 'Color',Transparency = 0,})

local function beamProjectile(g, v0, x0, t1) -- pasted from chat GPT
	local c = 0.5*0.5*0.5;
	local p3 = 0.5*g*t1*t1 + v0*t1 + x0;
	local p2 = p3 - (g*t1*t1 + v0*t1)/3;
	local p1 = (c*g*t1*t1 + 0.5*v0*t1 + x0 - c*(x0+p3))/(3*c) - p2;

	local curve0 = (p1 - x0).magnitude;
	local curve1 = (p2 - p3).magnitude;

	local b = (x0 - p3).unit;
	local r1 = (p1 - x0).unit;
	local u1 = r1:Cross(b).unit;
	local r2 = (p2 - p3).unit;
	local u2 = r2:Cross(b).unit;
	b = u1:Cross(r1).unit;

	local cf1 = CFrame.new(
		x0.x, x0.y, x0.z,
		r1.x, u1.x, b.x,
		r1.y, u1.y, b.y,
		r1.z, u1.z, b.z
	)

	local cf2 = CFrame.new(
		p3.x, p3.y, p3.z,
		r2.x, u2.x, b.x,
		r2.y, u2.y, b.y,
		r2.z, u2.z, b.z
	)

	return curve0, -curve1, cf1, cf2;
end

RunService.Heartbeat:Connect(function()

    for _, Value in pairs(workspace:GetChildren()) do
        if Value.Name == "Football" and Value:IsA("BasePart") then
            if Players.LocalPlayer:DistanceFromCharacter(Value.Position) <= Options.MagnetsDistance.Value and Toggles.Magnets.Value then
                firetouchinterest(Players.LocalPlayer.Character:WaitForChild("CatchRight"), Value, 0)
                firetouchinterest(Players.LocalPlayer.Character:WaitForChild("CatchRight"), Value, 1)
                task.wait()
                firetouchinterest(Players.LocalPlayer.Character:WaitForChild("CatchRight"), Value, 0)
                firetouchinterest(Players.LocalPlayer.Character:WaitForChild("CatchRight"), Value, 1)
                task.wait(0.1)
            end
        end
    end
    
    if Toggles["Anti-Jam"].Value then
        for index, player in pairs(game:GetService("Players"):GetChildren()) do
            if player ~= Players.LocalPlayer then
                local char = player.Character
                if char then
                    for index, part in pairs(char:GetChildren()) do
                        if part:IsA("BasePart") or part:IsA("MeshPart") and part.CanCollide then
                            if Inertia.AntiJam then
                                part.CanCollide = false
                            else
                                part.CanCollide = true
                            end
                        end
                    end
                end
            end
        end
    end
end)

Character.DescendantAdded:Connect(function(child)
	if string.match(child.Name, "FFmover") and Toggles["Anti-Block"].Value then
		print("Removed.")
		child:Destroy()
	end
end)

workspace.ChildAdded:Connect(function(child)
    if child.Name == "Football" and child:IsA("BasePart") and Toggles.FootballTracers.Value then
        task.wait()
        local vel = child.Velocity
        local pos = child.Position
        local c0, c1, cf1, cf2 = beamProjectile(Vector3.new(0, -28, 0), vel, pos, 10)
        local beam = Instance.new("Beam")
        local a0 = Instance.new("Attachment")
        local a1 = Instance.new("Attachment")
        beam.Color = ColorSequence.new(Options.FootballTracersColor.Value)
        beam.Transparency = NumberSequence.new(0, 0)
        beam.CurveSize0 = c0
        beam.CurveSize1 = c1
        beam.Name = "Hitbox"
        beam.Parent = workspace.Terrain
        beam.Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 1),
            NumberSequenceKeypoint.new(0.01, 0),
            NumberSequenceKeypoint.new(1, 0),
            NumberSequenceKeypoint.new(1, 0.01),
        })
        beam.Segments = 1750
        a0.Parent = workspace.Terrain
        a1.Parent = workspace.Terrain
        a0.CFrame = a0.Parent.CFrame:Inverse() * cf1
        a1.CFrame = a1.Parent.CFrame:Inverse() * cf2
        beam.Attachment0 = a0
        beam.Attachment1 = a1
        beam.Width0 = 0.5
        beam.Width1 = 0.5
        repeat task.wait() until child.Parent ~= workspace
        a0:Destroy()
        a1:Destroy()
    end
end)

game:GetService("Players").LocalPlayer.PlayerGui.ChildAdded:Connect(function(child)
	local hum = Character:FindFirstChild("Humanoid")
	if child.Name == "KickerGui" and Character and hum and Toggles.KickerAimbot.Value then
		local cursor = child:FindFirstChild("Cursor", true)
		local firstdone = false
		local seconddone = false
		VIM:SendMouseButtonEvent(0, 0, 0, true, nil, 0)
		repeat 
			task.wait()
		until cursor.Position.Y.Scale <= 0.03
		VIM:SendMouseButtonEvent(0, 0, 0, true, nil, 0)
		firstdone = true
		if firstdone then
			repeat 
				task.wait()
			until cursor.Position.Y.Scale >= 0.89
		end

		VIM:SendMouseButtonEvent(0, 0, 0, true, nil, 0)
		seconddone = true
		if seconddone and firstdone then
			VIM:SendMouseButtonEvent(0, 0, 0, true, nil, 0)
			hum:MoveTo(game.Workspace["KickerBall"].Position)
		end
	end
end)

warn("[Inertia.mov] FF2 Loaded!")

do -- Final Loading

	Library:SetWatermarkVisibility(true)
	local Connection = RunService.RenderStepped:Connect(function()
		FrameCounter += 1 

		if (tick() - FrameTimer) >= 1 then
			FPS = FrameCounter 
			FrameTimer = tick() 
			FrameCounter = 0 
		end 

		Library:SetWatermark(('inertia | %s fps | %s ms'):format(math.floor(FPS),math.floor(game:GetService('Stats').Network.ServerStatsItem['Data Ping']:GetValue()))) 
	end) 

	Library.KeybindFrame.Visible = true 

	Library:OnUnload(function()
		Connection:Disconnect()
		Connection = nil
		Library.Unloaded = true
	end)

	local MenuGroup = Tabs['UI Settings']:AddLeftGroupbox('Menu')
	MenuGroup:AddButton('Unload', function() Library:Unload() end)

	MenuGroup:AddLabel('Menu bind'):AddKeyPicker('MenuKeybind', { Default = 'End', NoUI = true, Text = 'Menu keybind' })

	Library.ToggleKeybind = Options.MenuKeybind

	ThemeManager:SetLibrary(Library)
	SaveManager:SetLibrary(Library)
	SaveManager:IgnoreThemeSettings()
	SaveManager:SetIgnoreIndexes({ 'MenuKeybind' })
	ThemeManager:SetFolder('Inertia')
	SaveManager:SetFolder('Inertia/SouthBronx')
	SaveManager:BuildConfigSection(Tabs['UI Settings'])
	ThemeManager:ApplyToTab(Tabs['UI Settings'])
	SaveManager:LoadAutoloadConfig()

	local TimeToLoad = math.abs(StartTime - tick())
	Library:Notify("Inertia: Took "..TimeToLoad.."s To Load",5)
end
